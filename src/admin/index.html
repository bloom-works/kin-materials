<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />
    <title>Content Manager</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  </head>
  <body>
    <!-- Include the script that builds the page and powers Decap CMS -->
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

    <script type="module">

    	const getMeta = calloutType => {
    		switch (calloutType) {
			    case 'event':
			      return { icon: 'calendar-week' };
			      break;
			    case 'apply':
			      return { icon: 'pen', title: 'How to apply'};
			      break;
			    case 'warning':
			      return { icon: 'exclamation-circle', title: 'Warning' };
			      break;
			    case 'note':
			      return { icon: 'info-circle', title: 'Note' };
			      break;
			  } 
    	}

    	import Page from "./templates/page.js";

    	CMS.registerPreviewTemplate("raw", Page);
    	CMS.registerPreviewStyle("../raw/raw.css", { raw: false });




    CMS.registerEditorComponent({
			  id: "download",
			  label: "Download Link",
			  fields: [
			  	{
			      name: 'link',
			      label: 'URL',
			      widget: 'string'
			    },
			    {
			      name: 'contents',
			      label: 'Link Text',
			      widget: 'string'
			    },
			    {
			    	name: 'type',
			    	label: "Type of Link",
			    	widget: 'select',
			    	options: [
			      	{ label: 'PDF', value: 'file-earmark-arrow-down'},
			      	{ label: 'External web page', value: 'box-arrow-up-right'},
			      	{ label: "Help documentation", value: 'question-circle'}
			      ]
			    }
			  ],
			  pattern: /^<section class='download'>(\r\n|\r|\n)<svg fill="currentColor">(\r\n|\r|\n)<use xlink:href="..\/bootstrap-icons.svg#(.*?)"><\/use>(\r\n|\r|\n)<\/svg>(\r\n|\r|\n)<a href="(.*?)">(.*?)<\/a>(\r\n|\r|\n)<\/section>$/ms,
			  fromBlock: function(match) {
			    return {
			    	link: match[6],
			      contents: match[7],
			      type: match[3]
			    };
			  },
			  toBlock: function(data) {
			    return `
<section class='download'>
<svg fill="currentColor">
<use xlink:href="../bootstrap-icons.svg#${data.type}"></use>
</svg>
<a href="${data.link}">${data.contents}</a>
</section>
		    `;
		  },
		  toPreview: function(data) {
		    return `
<section class='download'>
<svg fill="currentColor">
<use xlink:href="../bootstrap-icons.svg#${data.type}"></use>
</svg>
<a href="${data.link}">${data.contents}</a>
</section>
		`;
		  }
		});

		CMS.registerEditorComponent({
			  label: 'Contact methods',
				id: 'contactMethods',
				widget: 'list',
				min: 2,
				label_singular: "contact method",
				fields: [
				    {
				    	name: "type",
				    	label: 'Type',
				    	widget: 'select',
				    	options: [
				    		{ label: 'bank', value: 'file-earmark-arrow-down'},
	              { label: 'mail', value: 'box-arrow-up-right'},
	              { label: "online", value: 'question-circle'},
	              { label: "phone", value: 'question-circle'},
	              { label: "pen", value: 'question-circle'},
	              { label: "yes", value: 'question-circle'},
	              { label: "no", value: 'question-circle'}
				    	]
				    },
				    {
				    	name: "text",
				    	label: "Contents",
				    	widget: 'markdown',
				    	minimal: true
				    }
				  ],
			  pattern: /^<ul class="icon-list">(\r\n|\r|\n)(.*?)<\/ul>$/ms,
			  fromBlock: function(match) {
			    return {
			    	contactMethods: match[2]
			    };
			  },
			  toBlock: function(data) {
			    return `
<ul class="icon-list">
${data.contactMethods}
</ul>
		    `;
		  },
		  toPreview: function(data) {
		    return `
<ul class="icon-list">
${data.contactMethods}
</ul>
		`;
		  }
		});


    CMS.registerEditorComponent({
		  id: "callout",
		  label: "Callout",
		  fields: [
		    {
		      name: 'contents',
		      label: 'Contents',
		      widget: 'markdown',
		      minimal: true
		    },
		    {
		      name: 'type',
		      label: 'Type',
		      widget: 'select',
		      default: { label: 'Note', value: 'note'},
		      options: [
		      	{ label: 'How to apply', value: 'apply'},
		      	{ label: 'Note', value: 'note'},
		      	{ label: "Warning", value: 'warning'}
		      ]
		    }
		  ],
		  pattern: /^<section class='callout' data-type='(.*?)'>(\r\n|\r|\n)<header>(\r\n|\r|\n)<svg title='(.*?)' xmlns='http:\/\/www.w3.org\/2000\/svg' fill='currentColor' viewBox='0 0 16 16'>(\r\n|\r|\n)<use xlink:href='\/bootstrap-icons.svg#(.*?)'><\/use>(\r\n|\r|\n)<\/svg>(\r\n|\r|\n)<span>(.*?)<\/span>(\r\n|\r|\n)<\/header>(\r\n|\r|\n)<div class='callout-inner'>(.*?)<\/div>(\r\n|\r|\n)<\/section>$/ms,
		  fromBlock: function(match) {
		    return {
		      contents: match[12],
		      type: match[1]
		    };
		  },
		  toBlock: function(data) {
		    return `
<section class='callout' data-type='${data.type}'>
<header>
<svg title='${getMeta(data.type)["title"]}' xmlns='http://www.w3.org/2000/svg' fill='currentColor' viewBox='0 0 16 16'>
<use xlink:href='/bootstrap-icons.svg#${getMeta(data.type).icon}'></use>
</svg>
<span>${getMeta(data.type)["title"]}</span>
</header>
<div class='callout-inner'>${data.contents}</div>
</section>
		    `;
		  },
		  toPreview: function(data) {
		    return `
<section class='callout' data-type='${data.type}'>
<header>
<svg title='${getMeta(data.type)["title"]}' xmlns='http://www.w3.org/2000/svg' fill='currentColor' viewBox='0 0 16 16'>
<use xlink:href='/bootstrap-icons.svg#${getMeta(data.type).icon}'></use>
</svg>
<span>${getMeta(data.type)["title"]}</span>
</header>
<div class='callout-inner'>${data.contents}</div>
</section>
		`;
		  }
		});


    </script>
  </body>
</html>
